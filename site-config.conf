server {
	listen 80;
	listen [::]:80;

	# SSL configuration
	#

	listen 443 ssl;
	listen [::]:443 ssl;
	ssl_certificate /root/.acme.sh/phitogether.fun_ecc/fullchain.cer;
	ssl_certificate_key /root/.acme.sh/phitogether.fun_ecc/phitogether.fun.key;
	add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
	if ($scheme = http) {
#            return 301 https://$server_name$request_uri;
	}	    
#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	server_name phitogether.fun www.phitogether.fun;


	location /api/multi/ws {
		proxy_pass http://127.0.0.1:10809;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "Upgrade";
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header REMOTE-HOST $remote_addr;
	}

	location /api/
	{
		proxy_pass http://127.0.0.1:10809;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header REMOTE-HOST $remote_addr;

		add_header X-Cache $upstream_cache_status;

		add_header Cache-Control no-cache;
		expires 12h;
	}

	set $ptserver_port "8081";
	if ($http_cookie ~* "ptinsider") {
		set $ptserver_port "1808";
	}

	location /
	{
		root /var/www/html/;
		index index.html;
		try_files $uri $uri/ $uri/index.html =404;
	}

	location /api/pzapi/
	{
		proxy_pass http://127.0.0.1:8808/api.phi.zone:443/;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header REMOTE-HOST $remote_addr;

		add_header X-Cache $upstream_cache_status;

		add_header Cache-Control no-cache;
		expires 12h;
	}

	location /charts/
	{
		proxy_pass https://ptc.realtvop.eu.org;
		proxy_set_header Host ptc.realtvop.eu.org;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header REMOTE-HOST $remote_addr;

		proxy_ssl_name ptc.realtvop.eu.org;
		proxy_ssl_server_name on;
	}

	location /phizonev2Api/ {
		if ( $request_method = 'OPTIONS' ) { 
			return 200;
		}
		proxy_pass https://dev.phizone.cn/;
		proxy_set_header Host dev.phizone.cn;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
		proxy_set_header Query-String $args;

		proxy_ssl_name dev.phizone.cn;
		proxy_ssl_server_name on;

		# add_header 'Access-Control-Allow-Origin' '*';
		# add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE, HEAD, PATCH';
		# add_header 'Access-Control-Allow-Credentials' 'true';
		# add_header 'Access-Control-Allow-Headers' 'Authorization,Content-Type,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,X-Data-Type,X-Requested-With,X-Data-Type,X-Auth-Token';
	}



}